<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Bella Italia - Digitale Speisekarte</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç¥</text></svg>">
    <style>
        /* CSS bleibt identisch wie vorher */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f8f8;
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: calc(100vh - 200px);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            border: 2px solid #2c5530;
        }

        h1 {
            color: #2c5530;
            margin-bottom: 10px;
        }

        .header-phone {
            margin-top: 10px;
            font-size: 1.1em;
            color: #2c5530;
            font-weight: bold;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #2c5530;
            background: white;
            color: #2c5530;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active,
        .filter-btn:hover {
            background: #2c5530;
            color: white;
        }

        .cart-btn {
            padding: 8px 16px;
            background: white;
            color: #2c5530;
            border: 2px solid #2c5530;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
        }
        
        .cart-btn:hover {
            background: #2c5530;
            color: white;
        }

        .menu-categories {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .category-btn {
            padding: 10px 20px;
            background: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .category-btn.active {
            background: #2c5530;
            color: white;
        }

        .category-btn:hover {
            background: #2c5530;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .admin-controls-item {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            z-index: 10;
        }

        .admin-edit-btn, .admin-delete-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .admin-edit-btn { background: #f39c12; color: white; }
        .admin-delete-btn { background: #e74c3c; color: white; }

        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .menu-item h3 {
            color: #2c5530;
            margin-bottom: 10px;
        }

        .menu-item-number {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #2c5530;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
            z-index: 5;
        }

        .price {
            font-weight: bold;
            color: #e74c3c;
            font-size: 1.2em;
            margin: 10px 0;
        }

        .description {
            color: #666;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .tag {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            background: #f0f0f0;
            transition: all 0.3s;
        }

        .tag.vegetarisch { background: #d1ecf1; color: #0c5460; }
        .tag.scharf { background: #f8d7da; color: #721c24; }
        .tag.ohne-Schweinefleisch { background: #d4edda; color: #155724; }

        .tag:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .popup-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            background: none;
            border: none;
            color: #666;
        }

        .popup-image {
            width: 100%;
            height: 200px;
            background: #eee;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            overflow: hidden;
        }
        
        .popup-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .size-selection {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .size-selection h4 {
            margin-bottom: 15px;
            color: #2c5530;
            text-align: center;
        }

        .size-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .size-option {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .size-option:hover {
            border-color: #2c5530;
        }

        .size-option.selected {
            border-color: #2c5530;
            background: #f0f7f0;
        }

        .size-option input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .size-label {
            flex: 1;
            font-weight: bold;
        }

        .size-price {
            font-weight: bold;
            color: #e74c3c;
            font-size: 1.1em;
        }

        .size-description {
            font-size: 0.9em;
            color: #666;
            margin-left: 25px;
            margin-top: 2px;
        }

        .cart-popup-btn {
            width: 100%;
            padding: 12px;
            background: #2c5530;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: bold;
            transition: background 0.3s;
        }

        .cart-popup-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .cart-popup-btn:hover:not(:disabled) {
            background: #1e3a23;
        }

        .cart-popup-btn.added {
            background: #27ae60;
        }

        .cart-view {
            display: none;
        }

        .back-btn {
            padding: 10px 20px;
            background: #666;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .cart-summary {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .cart-total {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c5530;
            text-align: right;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #eee;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }

        .cart-item-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .cart-item-size {
            font-size: 0.9em;
            color: #666;
        }

        .cart-item-price {
            color: #e74c3c;
            font-weight: bold;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            padding: 5px 10px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .quantity-btn.remove {
            background: #e74c3c;
        }

        .item-quantity {
            font-weight: bold;
            min-width: 30px;
            text-align: center;
        }

        .cart-item-number {
            background: #2c5530;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8em;
            flex-shrink: 0;
        }

        .phone-btn {
            width: 100%;
            padding: 15px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s;
            text-decoration: none;
            display: block;
            text-align: center;
        }

        .phone-btn:hover {
            background: #219a52;
        }

        .phone-info {
            text-align: center;
            margin-top: 10px;
            color: #666;
            font-size: 0.9em;
        }

        .tags-checkbox-group {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .tags-checkbox-group h4 {
            margin-bottom: 10px;
            color: #2c5530;
        }

        .checkbox-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-item label {
            cursor: pointer;
            font-weight: normal;
            margin: 0;
        }

        .selected-tags-display {
            margin: 10px 0;
            padding: 10px;
            background: #e8f5e8;
            border-radius: 5px;
            border-left: 4px solid #27ae60;
        }

        .selected-tags-display span {
            display: inline-block;
            margin: 2px 5px;
            padding: 2px 8px;
            background: #27ae60;
            color: white;
            border-radius: 10px;
            font-size: 0.8em;
        }
        
        #adminArea {
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
            display: none;
        }

        #adminArea h2 {
            color: #3498db;
            margin-bottom: 20px;
        }

        .admin-form-group {
            margin-bottom: 15px;
        }

        .admin-form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .admin-form-group input[type="text"],
        .admin-form-group input[type="file"],
        .admin-form-group input[type="number"],
        .admin-form-group select,
        .admin-form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }

        .admin-form-group textarea {
            resize: vertical;
        }
        
        #imagePreview {
            width: 100%;
            height: 150px;
            background: #f0f0f0;
            border: 1px dashed #ccc;
            margin-top: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            overflow: hidden;
            border-radius: 5px;
        }
        
        #imagePreview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .admin-action-btn {
            padding: 10px 20px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 10px;
            margin-right: 10px;
            transition: background 0.3s;
        }
        
        .admin-action-btn.logout {
            background: #e74c3c;
        }
        
        .admin-action-btn.logout:hover {
            background: #c0392b;
        }
        
        .admin-action-btn:hover {
            background: #27ae60;
        }

        .admin-separator {
            border-top: 1px solid #eee;
            margin: 20px 0;
        }

        footer {
            background: #2c5530;
            color: white;
            padding: 20px 0;
            margin-top: 40px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .footer-section h3 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .footer-section p {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .footer-bottom {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        @media (max-width: 768px) {
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .filter-buttons {
                justify-content: center;
            }

            .cart-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .cart-item-controls {
                width: 100%;
                justify-content: space-between;
            }

            .checkbox-row {
                flex-direction: column;
                gap: 10px;
            }

            .footer-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .size-options {
                gap: 8px;
            }

            .size-option {
                padding: 10px 12px;
            }
        }

        .category-admin-list {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .category-admin-item {
            display:flex;
            gap:8px;
            align-items:center;
            justify-content:space-between;
            background:#fafafa;
            padding:8px;
            border-radius:6px;
            border:1px solid #eee;
        }
        .category-admin-item .left {
            display:flex;
            gap:8px;
            align-items:center;
        }
        .category-admin-item button {
            padding:6px 10px;
            border-radius:6px;
            border:none;
            cursor:pointer;
        }
        .category-edit-btn { background:#f39c12; color:white; }
        .category-delete-btn { background:#e74c3c; color:white; }
        .category-move-btn { 
            background: #3498db; 
            color: white; 
            padding: 6px 8px;
        }
        .category-move-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .sizes-admin-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .size-admin-item {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .size-admin-item input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .size-admin-item .size-price {
            width: 100px;
        }

        .remove-size-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
        }

        .add-size-btn {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            margin-top: 10px;
        }

        .confirmation-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .confirmation-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .confirmation-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .confirm-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .confirm-yes {
            background: #27ae60;
            color: white;
        }

        .confirm-yes:hover {
            background: #219a52;
        }

        .confirm-no {
            background: #e74c3c;
            color: white;
        }

        .confirm-no:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 id="restaurantName">üçù Restaurant Bella Italia</h1>
            <p>Willkommen zu unserer digitalen Speisekarte</p>
            <div class="header-phone" id="headerPhone">üìû 0123-4567890</div>
        </header>
        
        <div id="adminArea">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h2>Admin-Bereich üîí</h2>
                <button type="button" class="admin-action-btn logout" id="adminLogoutBtn">Admin Logout</button>
            </div>
            <p>Dr√ºcken Sie <code>Strg + Alt + A</code> (oder <code>Cmd + Alt + A</code> auf Mac), um den Admin-Bereich zu √∂ffnen.</p>
            
            <form id="menuItemForm">
                <h3>Men√ºpunkt hinzuf√ºgen/bearbeiten</h3>
                <input type="hidden" id="mealIdInput" value="">
                
                <div class="admin-form-group">
                    <label for="mealNumber">Nummerierung (optional, z.B. 1, 2, 3...)</label>
                    <input type="number" id="mealNumber" min="0" step="1" placeholder="Automatisch wenn leer">
                </div>

                <div class="admin-form-group">
                    <label for="mealName">Name des Gerichts</label>
                    <input type="text" id="mealName" required>
                </div>
                
                <div class="admin-form-group">
                    <label for="mealCategory">Kategorie</label>
                    <select id="mealCategory" required>
                        <!-- Wird dynamisch gef√ºllt -->
                    </select>
                </div>
                
                <div class="sizes-admin-section">
                    <h4>Gr√∂√üen und Preise</h4>
                    <p>F√ºr Gerichte ohne Gr√∂√üen einfach leer lassen.</p>
                    <div id="sizesContainer">
                        <!-- Gr√∂√üen werden hier dynamisch eingef√ºgt -->
                    </div>
                    <button type="button" class="add-size-btn" id="addSizeBtn">+ Gr√∂√üe hinzuf√ºgen</button>
                </div>

                <div class="admin-form-group" id="singlePriceGroup">
                    <label for="mealPrice">Preis (‚Ç¨) - nur wenn keine Gr√∂√üen</label>
                    <input type="number" id="mealPrice" step="0.01" placeholder="0.00">
                </div>
                
                <div class="admin-form-group">
                    <label for="mealDescription">Beschreibung</label>
                    <textarea id="mealDescription" rows="3" required></textarea>
                </div>
                
                <div class="tags-checkbox-group">
                    <h4>Tags ausw√§hlen</h4>
                    <div class="checkbox-row">
                        <div class="checkbox-item">
                            <input type="checkbox" id="tagVegetarisch" name="tags" value="vegetarisch">
                            <label for="tagVegetarisch">Vegetarisch</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="tagScharf" name="tags" value="scharf">
                            <label for="tagScharf">Scharf</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="tagOhneSchweinefleisch" name="tags" value="ohne-Schweinefleisch">
                            <label for="tagOhneSchweinefleisch">Ohne Schweinefleisch</label>
                        </div>
                    </div>
                    <div id="selectedTagsDisplay" class="selected-tags-display" style="display: none;">
                        <strong>Ausgew√§hlte Tags:</strong>
                    </div>
                </div>
                
                <div class="admin-form-group">
                    <label for="mealIngredients">Zutaten (durch Komma trennen)</label>
                    <input type="text" id="mealIngredients" placeholder="Baguette,Tomaten,Basilikum">
                </div>

                <div class="admin-form-group">
                    <label for="mealImageFile">Bilddatei hochladen (wird automatisch verkleinert)</label>
                    <input type="file" id="mealImageFile" accept="image/jpeg, image/png">
                    <div id="imagePreview">Bildvorschau</div>
                </div>
                
                <button type="submit" class="admin-action-btn" id="saveMealBtn">Men√ºpunkt speichern</button>
                <button type="button" class="admin-action-btn" id="resetFormBtn" style="background:#e67e22;">Formular zur√ºcksetzen</button>
                
            </form>
            
            <div class="admin-separator"></div>

            <h3>Aktuelle Gerichte (bearbeiten durch Klick im Men√º)</h3>
            <p>Klicken Sie auf ein Gericht unten in der Speisekarte, um es im Bearbeitungsformular zu laden.</p>

            <div class="admin-separator"></div>

            <h3>Kategorien verwalten</h3>
            <form id="categoryAdminForm" style="margin-bottom:10px;">
                <div class="admin-form-group">
                    <label for="newCategoryInput">Neue Kategorie hinzuf√ºgen</label>
                    <input type="text" id="newCategoryInput" placeholder="z. B. vorspeisen, suppen..." required>
                </div>
                <button type="submit" class="admin-action-btn">Kategorie hinzuf√ºgen</button>
            </form>

            <div id="categoryAdminList" class="category-admin-list"></div>

            <div class="admin-separator"></div>

            <h3>Restaurant Informationen</h3>
            <form id="restaurantInfoForm">
                <div class="admin-form-group">
                    <label for="restaurantNameInput">Restaurant Name</label>
                    <input type="text" id="restaurantNameInput" placeholder="Restaurant Bella Italia">
                </div>
                
                <div class="admin-form-group">
                    <label for="restaurantPhoneInput">Telefonnummer</label>
                    <input type="text" id="restaurantPhoneInput" placeholder="0123-4567890">
                </div>
                
                <div class="admin-form-group">
                    <label for="restaurantAddressInput">Stra√üe und Hausnummer</label>
                    <input type="text" id="restaurantAddressInput" placeholder="Musterstra√üe 123">
                </div>
                
                <div class="admin-form-group">
                    <label for="restaurantZipInput">PLZ</label>
                    <input type="text" id="restaurantZipInput" placeholder="12345">
                </div>
                
                <div class="admin-form-group">
                    <label for="restaurantCityInput">Stadt</label>
                    <input type="text" id="restaurantCityInput" placeholder="Musterstadt">
                </div>
                
                <div class="admin-form-group">
                    <label for="restaurantHoursInput">√ñffnungszeiten</label>
                    <textarea id="restaurantHoursInput" rows="3" placeholder="Mo-Fr: 11:00-22:00&#10;Sa-So: 12:00-23:00"></textarea>
                </div>
                
                <button type="submit" class="admin-action-btn">Informationen speichern</button>
            </form>

        </div>
        
        <div class="controls">
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">Alle</button>
                <button class="filter-btn" data-filter="vegetarisch">Vegetarisch</button>
                <button class="filter-btn" data-filter="scharf">Scharf</button>
                <button class="filter-btn" data-filter="ohne-Schweinefleisch">Ohne Schweinefleisch</button>
            </div>
            <button class="cart-btn" id="showCart">
                üõí Warenkorb
            </button>
        </div>

        <div class="menu-categories" id="menuCategoriesContainer">
            <!-- Kategorien werden dynamisch gerendert -->
        </div>

        <div class="menu-view" id="menuView">
            <div class="menu-grid" id="menuGrid">
                <!-- Men√ºpunkte werden hier angezeigt -->
            </div>
        </div>

        <div class="cart-view" id="cartView">
            <button class="back-btn" id="backToMenu">‚Üê Zur√ºck zur Karte</button>
            <h2>Ihr Warenkorb</h2>
            
            <div class="cart-summary">
                <div id="cartItems">
                    <!-- Warenkorb Items werden hier eingef√ºgt -->
                </div>
                <div class="cart-total" id="cartTotal">
                    Gesamt: ‚Ç¨ 0,00
                </div>
            </div>
            
            <a href="tel:+491234567890" class="phone-btn" id="cartPhoneBtn">üìû Jetzt anrufen & bestellen: 0123-4567890</a>
            <div class="phone-info">Rufen Sie uns an um Ihre Bestellung aufzugeben</div>
        </div>
    </div>

    <footer id="restaurantFooter">
        <div class="footer-content">
            <div class="footer-section">
                <h3 id="footerRestaurantName">Restaurant Bella Italia</h3>
                <p id="footerAddress">Musterstra√üe 123</p>
                <p id="footerZipCity">12345 Musterstadt</p>
            </div>
            <div class="footer-section">
                <h3>√ñffnungszeiten</h3>
                <div id="footerHours">
                    <p>Mo-Fr: 11:00-22:00</p>
                    <p>Sa-So: 12:00-23:00</p>
                </div>
            </div>
            <div class="footer-section">
                <h3>Kontakt</h3>
                <p id="footerPhone">üìû 0123-4567890</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Restaurant Bella Italia. Alle Rechte vorbehalten.</p>
        </div>
    </footer>

    <div class="popup" id="mealPopup">
        <div class="popup-content">
            <button class="close-btn" id="closePopup">&times;</button>
            <div class="popup-image" id="popupImage">
            </div>
            <h2 id="popupTitle">Gericht Name</h2>
            
            <div class="size-selection" id="sizeSelection" style="display: none;">
                <h4>Bitte w√§hlen Sie eine Gr√∂√üe:</h4>
                <div class="size-options" id="sizeOptions">
                    <!-- Gr√∂√üen werden hier dynamisch eingef√ºgt -->
                </div>
            </div>

            <div class="price" id="popupPrice">‚Ç¨ 0,00</div>
            <p class="description" id="popupDescription">Beschreibung des Gerichts...</p>
            <div class="tags" id="popupTags">
            </div>
            <div id="popupIngredients">
                <h4>Zutaten:</h4>
                <ul id="ingredientsList">
                </ul>
            </div>
            <button class="cart-popup-btn" id="cartPopupBtn" disabled>üõí Bitte Gr√∂√üe w√§hlen</button>
        </div>
    </div>

    <div class="confirmation-popup" id="confirmationPopup">
        <div class="confirmation-content">
            <h3 id="confirmationTitle">In den Warenkorb legen?</h3>
            <p id="confirmationText">M√∂chten Sie dieses Gericht in den Warenkorb legen?</p>
            <div class="confirmation-buttons">
                <button class="confirm-btn confirm-yes" id="confirmYes">Ja, hinzuf√ºgen</button>
                <button class="confirm-btn confirm-no" id="confirmNo">Abbrechen</button>
            </div>
        </div>
    </div>

    <script>
        // --- KORREKTUR: Leere Startdaten ---
        const initialMenuData = [];

        // Restaurant Informationen
        const defaultRestaurantInfo = {
            name: "Restaurant Bella Italia",
            phone: "0123-4567890",
            address: "Musterstra√üe 123",
            zip: "12345",
            city: "Musterstadt",
            hours: "Mo-Fr: 11:00-22:00\nSa-So: 12:00-23:00"
        };

        // Standard-Kategorien
        const defaultCategories = ['vorspeisen','hauptgerichte','desserts','getraenke'];

        // --- Status Variablen ---
        let menuData = [];
        let restaurantInfo = {};
        let currentFilter = 'all';
        let currentCategory = 'all';
        let cart = [];
        let currentMealId = null;
        let isAdminMode = false;
        let currentBase64Image = null;
        let selectedSize = null;
        let pendingAddToCart = null;

        // --- Initialisierungsfunktionen ---
        function loadMenuData() {
            const storedData = localStorage.getItem('menuData');
            if (storedData) {
                try {
                    const data = JSON.parse(storedData);
                    console.log('Geladene Men√ºdaten:', data);
                    return Array.isArray(data) ? data : [];
                } catch (e) {
                    console.error("Fehler beim Laden der Men√ºdaten:", e);
                    localStorage.setItem('menuData', JSON.stringify([]));
                    return [];
                }
            }
            localStorage.setItem('menuData', JSON.stringify([]));
            return [];
        }

        function saveMenuData() {
            console.log('Speichere Men√ºdaten:', menuData);
            localStorage.setItem('menuData', JSON.stringify(menuData));
        }

        function loadRestaurantInfo() {
            const stored = localStorage.getItem('restaurantInfo');
            if (stored) {
                try {
                    return JSON.parse(stored);
                } catch (e) {
                    console.error("Fehler beim Laden der Restaurant-Info:", e);
                    localStorage.setItem('restaurantInfo', JSON.stringify(defaultRestaurantInfo));
                    return {...defaultRestaurantInfo};
                }
            }
            localStorage.setItem('restaurantInfo', JSON.stringify(defaultRestaurantInfo));
            return {...defaultRestaurantInfo};
        }

        function saveRestaurantInfo(info) {
            localStorage.setItem('restaurantInfo', JSON.stringify(info));
        }

        function loadCategories() {
            const stored = localStorage.getItem('categories');
            if (stored) {
                try {
                    const parsed = JSON.parse(stored);
                    return Array.isArray(parsed) && parsed.length > 0 ? parsed : [...defaultCategories];
                } catch (e) {
                    console.error("Fehler beim Laden der Kategorien:", e);
                    localStorage.setItem('categories', JSON.stringify(defaultCategories));
                    return [...defaultCategories];
                }
            }
            localStorage.setItem('categories', JSON.stringify(defaultCategories));
            return [...defaultCategories];
        }

        function saveCategories(cats) {
            localStorage.setItem('categories', JSON.stringify(cats));
        }

        // --- Hilfsfunktionen ---
        function slugify(str) {
            return str.toString().toLowerCase().trim().replace(/\s+/g, '-').replace(/[^\w\-√§√∂√º√ü-]+/g, '').replace(/\-\-+/g, '-');
        }

        function displayLabelForCategory(catId) {
            if (!catId || catId === 'all') return 'Alle Kategorien';
            return catId.split(/[-_ ]+/).map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(' ');
        }

        function getDisplayPrice(meal) {
            if (meal.sizes && meal.sizes.length > 0) {
                const prices = meal.sizes.map(size => size.price);
                const minPrice = Math.min(...prices);
                const maxPrice = Math.max(...prices);
                if (minPrice === maxPrice) {
                    return `‚Ç¨ ${minPrice.toFixed(2)}`;
                }
                return `‚Ç¨ ${minPrice.toFixed(2)} - ${maxPrice.toFixed(2)}`;
            }
            return meal.price ? `‚Ç¨ ${meal.price.toFixed(2)}` : '‚Ç¨ 0,00';
        }

        function updateCartTotal() {
            const total = cart.reduce((sum, item) => {
                const meal = menuData.find(m => m.id === item.mealId);
                if (!meal) return sum;
                
                if (meal.sizes && meal.sizes.length > 0) {
                    const size = meal.sizes.find(s => s.size === item.selectedSize);
                    return sum + (size ? size.price * item.quantity : 0);
                }
                return sum + ((meal.price || 0) * item.quantity);
            }, 0);
            cartTotal.textContent = `Gesamt: ‚Ç¨ ${total.toFixed(2)}`;
        }

        function updateSelectedTagsDisplay() {
            const checkboxes = document.querySelectorAll('input[name="tags"]:checked');
            const selectedTags = Array.from(checkboxes).map(cb => cb.value);
            
            if (selectedTags.length > 0) {
                selectedTagsDisplay.style.display = 'block';
                selectedTagsDisplay.innerHTML = '<strong>Ausgew√§hlte Tags:</strong> ' + 
                    selectedTags.map(tag => `<span>${tag}</span>`).join('');
            } else {
                selectedTagsDisplay.style.display = 'none';
            }
        }

        function setCheckboxesFromTags(tags) {
            document.querySelectorAll('input[name="tags"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            if (tags && tags.length > 0) {
                tags.forEach(tag => {
                    const checkbox = document.querySelector(`input[name="tags"][value="${tag}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });
            }
            
            updateSelectedTagsDisplay();
        }

        function getSelectedTags() {
            const checkboxes = document.querySelectorAll('input[name="tags"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // --- DOM Elemente ---
        const menuGrid = document.getElementById('menuGrid');
        const cartItems = document.getElementById('cartItems');
        const mealPopup = document.getElementById('mealPopup');
        const cartView = document.getElementById('cartView');
        const menuView = document.getElementById('menuView');
        const adminArea = document.getElementById('adminArea');
        const adminLogoutBtn = document.getElementById('adminLogoutBtn');
        const menuItemForm = document.getElementById('menuItemForm');
        const saveMealBtn = document.getElementById('saveMealBtn');
        const popupImageDiv = document.getElementById('popupImage');
        const mealImageFile = document.getElementById('mealImageFile');
        const imagePreview = document.getElementById('imagePreview');
        const menuCategoriesContainer = document.getElementById('menuCategoriesContainer');
        const cartTotal = document.getElementById('cartTotal');
        const selectedTagsDisplay = document.getElementById('selectedTagsDisplay');
        const mealCategorySelect = document.getElementById('mealCategory');
        const categoryAdminForm = document.getElementById('categoryAdminForm');
        const newCategoryInput = document.getElementById('newCategoryInput');
        const categoryAdminList = document.getElementById('categoryAdminList');
        const sizesContainer = document.getElementById('sizesContainer');
        const addSizeBtn = document.getElementById('addSizeBtn');
        const sizeSelection = document.getElementById('sizeSelection');
        const sizeOptions = document.getElementById('sizeOptions');
        const singlePriceGroup = document.getElementById('singlePriceGroup');
        const confirmationPopup = document.getElementById('confirmationPopup');
        const confirmationTitle = document.getElementById('confirmationTitle');
        const confirmationText = document.getElementById('confirmationText');
        const confirmYes = document.getElementById('confirmYes');
        const confirmNo = document.getElementById('confirmNo');
        const restaurantInfoForm = document.getElementById('restaurantInfoForm');

        let categories = [];

        // --- Hauptinitialisierung ---
        function initializeMenu() {
            console.log('Initialisiere Men√º...');
            
            // Daten laden
            menuData = loadMenuData();
            restaurantInfo = loadRestaurantInfo();
            categories = loadCategories();
            cart = JSON.parse(localStorage.getItem('cart')) || [];
            
            console.log('Men√ºdaten nach Laden:', menuData);
            console.log('Kategorien:', categories);
            console.log('Warenkorb:', cart);
            
            // UI rendern
            renderCategoriesUI();
            renderMenuItems();
            setupEventListeners();
            updateRestaurantDisplay();
            loadRestaurantInfoIntoForm();
            setupSizeAdmin();
            
            // Standard-Ansicht setzen
            adminArea.style.display = 'none';
            menuView.style.display = 'block';
            cartView.style.display = 'none';
        }

        function loadRestaurantInfoIntoForm() {
            document.getElementById('restaurantNameInput').value = restaurantInfo.name || '';
            document.getElementById('restaurantPhoneInput').value = restaurantInfo.phone || '';
            document.getElementById('restaurantAddressInput').value = restaurantInfo.address || '';
            document.getElementById('restaurantZipInput').value = restaurantInfo.zip || '';
            document.getElementById('restaurantCityInput').value = restaurantInfo.city || '';
            document.getElementById('restaurantHoursInput').value = restaurantInfo.hours || '';
        }

        function updateRestaurantDisplay() {
            document.getElementById('restaurantName').textContent = restaurantInfo.name || 'Restaurant Bella Italia';
            document.getElementById('headerPhone').textContent = `üìû ${restaurantInfo.phone || '0123-4567890'}`;
            document.getElementById('footerRestaurantName').textContent = restaurantInfo.name || 'Restaurant Bella Italia';
            document.getElementById('footerAddress').textContent = restaurantInfo.address || 'Musterstra√üe 123';
            document.getElementById('footerZipCity').textContent = `${restaurantInfo.zip || '12345'} ${restaurantInfo.city || 'Musterstadt'}`;
            document.getElementById('footerPhone').textContent = `üìû ${restaurantInfo.phone || '0123-4567890'}`;
            
            const hoursContainer = document.getElementById('footerHours');
            hoursContainer.innerHTML = (restaurantInfo.hours || 'Mo-Fr: 11:00-22:00\nSa-So: 12:00-23:00').split('\n').map(line => `<p>${line}</p>`).join('');
            
            const cartPhoneBtn = document.getElementById('cartPhoneBtn');
            cartPhoneBtn.textContent = `üìû Jetzt anrufen & bestellen: ${restaurantInfo.phone || '0123-4567890'}`;
            cartPhoneBtn.href = `tel:${(restaurantInfo.phone || '0123-4567890').replace(/[^\d+]/g, '')}`;
        }

        // --- Gr√∂√üen-Admin ---
        function setupSizeAdmin() {
            addSizeBtn.addEventListener('click', addSizeRow);
            
            sizesContainer.addEventListener('input', function() {
                const hasSizes = sizesContainer.children.length > 0;
                singlePriceGroup.style.display = hasSizes ? 'none' : 'block';
            });
        }

        function addSizeRow(sizeData = { size: '', price: '', description: '' }) {
            const div = document.createElement('div');
            div.className = 'size-admin-item';
            div.innerHTML = `
                <input type="text" class="size-name" placeholder="Gr√∂√üe (z.B. klein)" value="${sizeData.size}">
                <input type="number" class="size-price" placeholder="Preis" step="0.01" value="${sizeData.price}">
                <input type="text" class="size-desc" placeholder="Beschreibung (z.B. 28cm)" value="${sizeData.description}">
                <button type="button" class="remove-size-btn">üóëÔ∏è</button>
            `;
            
            div.querySelector('.remove-size-btn').addEventListener('click', function() {
                div.remove();
                if (sizesContainer.children.length === 0) {
                    singlePriceGroup.style.display = 'block';
                }
            });
            
            sizesContainer.appendChild(div);
            
            if (sizesContainer.children.length > 0) {
                singlePriceGroup.style.display = 'none';
            }
        }

        function getSizesFromForm() {
            const sizeItems = sizesContainer.querySelectorAll('.size-admin-item');
            const sizes = [];
            
            sizeItems.forEach(item => {
                const size = item.querySelector('.size-name').value.trim();
                const price = parseFloat(item.querySelector('.size-price').value);
                const description = item.querySelector('.size-desc').value.trim();
                
                if (size && !isNaN(price)) {
                    sizes.push({
                        size: size,
                        price: price,
                        description: description
                    });
                }
            });
            
            return sizes;
        }

        function loadSizesIntoForm(sizes) {
            sizesContainer.innerHTML = '';
            
            if (sizes && sizes.length > 0) {
                sizes.forEach(size => {
                    addSizeRow(size);
                });
                singlePriceGroup.style.display = 'none';
            } else {
                singlePriceGroup.style.display = 'block';
            }
        }

        // --- Rendering Funktionen ---
        function renderCategoriesUI() {
            menuCategoriesContainer.innerHTML = '';
            
            // "Alle Kategorien" Button
            const allBtn = document.createElement('button');
            allBtn.className = 'category-btn' + (currentCategory === 'all' ? ' active' : '');
            allBtn.dataset.category = 'all';
            allBtn.textContent = 'Alle Kategorien';
            allBtn.addEventListener('click', () => {
                currentCategory = 'all';
                document.querySelectorAll('#menuCategoriesContainer .category-btn').forEach(b => b.classList.remove('active'));
                allBtn.classList.add('active');
                renderMenuItems();
            });
            menuCategoriesContainer.appendChild(allBtn);

            // Kategorie-Buttons
            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'category-btn' + (currentCategory === cat ? ' active' : '');
                btn.dataset.category = cat;
                btn.textContent = displayLabelForCategory(cat);
                btn.addEventListener('click', () => {
                    currentCategory = cat;
                    document.querySelectorAll('#menuCategoriesContainer .category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderMenuItems();
                });
                menuCategoriesContainer.appendChild(btn);
            });

            // Kategorien f√ºr Admin-Formular
            mealCategorySelect.innerHTML = '';
            categories.forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = displayLabelForCategory(cat);
                mealCategorySelect.appendChild(opt);
            });

            // Admin-Kategorien-Liste
            categoryAdminList.innerHTML = '';
            categories.forEach((cat, index) => {
                const div = document.createElement('div');
                div.className = 'category-admin-item';
                const left = document.createElement('div');
                left.className = 'left';
                const label = document.createElement('div');
                label.textContent = displayLabelForCategory(cat);
                left.appendChild(label);
                const right = document.createElement('div');

                const upBtn = document.createElement('button');
                upBtn.className = 'category-move-btn';
                upBtn.textContent = '‚¨ÜÔ∏è';
                upBtn.title = 'Nach oben verschieben';
                upBtn.disabled = index === 0;
                upBtn.addEventListener('click', () => {
                    if (index > 0) {
                        [categories[index], categories[index-1]] = [categories[index-1], categories[index]];
                        saveCategories(categories);
                        renderCategoriesUI();
                        renderMenuItems();
                    }
                });

                const downBtn = document.createElement('button');
                downBtn.className = 'category-move-btn';
                downBtn.textContent = '‚¨áÔ∏è';
                downBtn.title = 'Nach unten verschieben';
                downBtn.disabled = index === categories.length - 1;
                downBtn.addEventListener('click', () => {
                    if (index < categories.length - 1) {
                        [categories[index], categories[index+1]] = [categories[index+1], categories[index]];
                        saveCategories(categories);
                        renderCategoriesUI();
                        renderMenuItems();
                    }
                });

                const editBtn = document.createElement('button');
                editBtn.className = 'category-edit-btn';
                editBtn.textContent = '‚úèÔ∏è';
                editBtn.title = 'Umbenennen';
                editBtn.addEventListener('click', () => {
                    const newLabel = prompt('Neuer Name f√ºr Kategorie (Anzeige):', displayLabelForCategory(cat));
                    if (!newLabel) return;
                    const newId = slugify(newLabel);
                    if (newId === cat) {
                        alert('Kategorie unver√§ndert oder bereits vorhanden.');
                        return;
                    }
                    if (categories.includes(newId)) {
                        alert('Eine Kategorie mit diesem Namen existiert bereits.');
                        return;
                    }
                    const idx = categories.indexOf(cat);
                    if (idx !== -1) {
                        const oldId = categories[idx];
                        categories[idx] = newId;
                        menuData = menuData.map(m => m.category === oldId ? { ...m, category: newId } : m);
                        saveCategories(categories);
                        saveMenuData();
                        renderCategoriesUI();
                        renderMenuItems();
                    }
                });

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'category-delete-btn';
                deleteBtn.textContent = 'üóëÔ∏è';
                deleteBtn.title = 'L√∂schen';
                deleteBtn.addEventListener('click', () => {
                    if (confirm(`Kategorie "${displayLabelForCategory(cat)}" wirklich l√∂schen? Alle Gerichte dieser Kategorie werden ebenfalls gel√∂scht.`)) {
                        categories = categories.filter(c => c !== cat);
                        menuData = menuData.filter(m => m.category !== cat);
                        saveCategories(categories);
                        saveMenuData();
                        if (currentCategory === cat) currentCategory = 'all';
                        renderCategoriesUI();
                        renderMenuItems();
                    }
                });

                right.appendChild(upBtn);
                right.appendChild(downBtn);
                right.appendChild(editBtn);
                right.appendChild(deleteBtn);
                div.appendChild(left);
                div.appendChild(right);
                categoryAdminList.appendChild(div);
            });
        }

        function renderMenuItems() {
            console.log('Rendere Men√ºpunkte mit Daten:', menuData);
            menuGrid.innerHTML = '';
            
            if (menuData.length === 0) {
                menuGrid.innerHTML = '<div class="no-items">Noch keine Gerichte vorhanden. Bitte f√ºgen Sie im Admin-Bereich Gerichte hinzu.</div>';
                return;
            }
            
            const filteredMeals = menuData.filter(meal => {
                const categoryMatch = currentCategory === 'all' || meal.category === currentCategory;
                const filterMatch = currentFilter === 'all' || (meal.tags && meal.tags.includes(currentFilter));
                return categoryMatch && filterMatch;
            });

            console.log('Gefilterte Gerichte:', filteredMeals);

            filteredMeals.forEach(meal => {
                const mealElement = createMealElement(meal);
                menuGrid.appendChild(mealElement);
            });
        }

        function createMealElement(meal) {
            const div = document.createElement('div');
            div.className = 'menu-item';
            div.setAttribute('data-id', meal.id);
            
            const tagsHTML = (meal.tags || []).map(tag => 
                `<span class="tag ${tag}">${tag}</span>`
            ).join('');
            
            // Warenkorb-Indikator
            let cartIndicator = '';
            const cartItemsForMeal = cart.filter(item => item.mealId === meal.id);
            if (cartItemsForMeal.length > 0) {
                const totalQuantity = cartItemsForMeal.reduce((sum, item) => sum + item.quantity, 0);
                let sizeInfo = '';
                if (meal.sizes && meal.sizes.length > 0) {
                    const sizesInCart = cartItemsForMeal.map(item => `${item.quantity}x ${item.selectedSize}`).join(', ');
                    sizeInfo = ` (${sizesInCart})`;
                }
                cartIndicator = `<span class="tag" style="background:#d4edda; color:#155724;">üõí ${totalQuantity}x${sizeInfo}</span>`;
            }

            let adminControls = '';
            if (isAdminMode) {
                adminControls = `
                    <div class="admin-controls-item">
                        <button class="admin-edit-btn" data-id="${meal.id}" title="Bearbeiten">‚úèÔ∏è</button>
                        <button class="admin-delete-btn" data-id="${meal.id}" title="L√∂schen">üóëÔ∏è</button>
                    </div>
                `;
            }

            const numberDisplay = meal.number ? `<div class="menu-item-number">${meal.number}</div>` : '';
            const displayPrice = getDisplayPrice(meal);

            div.innerHTML = `
                ${numberDisplay}
                ${adminControls}
                <h3>${meal.name}</h3>
                <div class="price">${displayPrice}</div>
                <p class="description">${meal.description || 'Keine Beschreibung'}</p>
                <div class="tags">
                    ${tagsHTML}
                    ${cartIndicator}
                </div>
            `;
            
            return div;
        }

        function renderSizeOptions(meal) {
            sizeOptions.innerHTML = '';
            selectedSize = null;
            
            if (meal.sizes && meal.sizes.length > 0) {
                sizeSelection.style.display = 'block';
                
                meal.sizes.forEach((sizeOption, index) => {
                    const label = document.createElement('label');
                    label.className = 'size-option';
                    label.innerHTML = `
                        <input type="radio" name="mealSize" value="${sizeOption.size}" ${index === 0 ? 'checked' : ''}>
                        <span class="size-label">${sizeOption.size}</span>
                        <span class="size-price">‚Ç¨ ${sizeOption.price.toFixed(2)}</span>
                    `;
                    
                    if (sizeOption.description) {
                        const desc = document.createElement('div');
                        desc.className = 'size-description';
                        desc.textContent = sizeOption.description;
                        label.appendChild(desc);
                    }
                    
                    label.addEventListener('click', function() {
                        document.querySelectorAll('.size-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        this.classList.add('selected');
                        selectedSize = sizeOption.size;
                        document.getElementById('cartPopupBtn').disabled = false;
                        document.getElementById('cartPopupBtn').textContent = `üõí In den Warenkorb - ‚Ç¨ ${sizeOption.price.toFixed(2)}`;
                    });
                    
                    if (index === 0) {
                        label.classList.add('selected');
                        selectedSize = sizeOption.size;
                    }
                    
                    sizeOptions.appendChild(label);
                });
                
                document.getElementById('cartPopupBtn').disabled = false;
                const firstSize = meal.sizes[0];
                document.getElementById('cartPopupBtn').textContent = `üõí In den Warenkorb - ‚Ç¨ ${firstSize.price.toFixed(2)}`;
            } else {
                sizeSelection.style.display = 'none';
                selectedSize = null;
                document.getElementById('cartPopupBtn').disabled = false;
                document.getElementById('cartPopupBtn').textContent = `üõí In den Warenkorb - ‚Ç¨ ${(meal.price || 0).toFixed(2)}`;
            }
        }

        function openMealPopup(mealId) {
            const meal = menuData.find(m => m.id === mealId);
            if (!meal) return;

            currentMealId = mealId;
            selectedSize = null;
            
            popupImageDiv.innerHTML = '';
            if (meal.imageBase64) {
                const img = document.createElement('img');
                img.src = meal.imageBase64;
                img.alt = meal.name;
                popupImageDiv.appendChild(img);
            } else {
                popupImageDiv.textContent = `[Kein Bild verf√ºgbar f√ºr ${meal.name}]`;
            }

            document.getElementById('popupTitle').textContent = meal.name;
            
            if (meal.sizes && meal.sizes.length > 0) {
                document.getElementById('popupPrice').textContent = '';
            } else {
                document.getElementById('popupPrice').textContent = `‚Ç¨ ${(meal.price || 0).toFixed(2)}`;
            }
            
            document.getElementById('popupDescription').textContent = meal.description || 'Keine Beschreibung';
            
            const tagsContainer = document.getElementById('popupTags');
            tagsContainer.innerHTML = (meal.tags || []).map(tag => 
                `<span class="tag ${tag}">${tag}</span>`
            ).join('');
            
            const ingredientsList = document.getElementById('ingredientsList');
            ingredientsList.innerHTML = (meal.ingredients || []).map(ingredient => 
                `<li>${ingredient}</li>`
            ).join('');
            
            renderSizeOptions(meal);
            
            const cartBtn = document.getElementById('cartPopupBtn');
            const cartItemsForMeal = cart.filter(item => item.mealId === mealId);
            
            if (cartItemsForMeal.length > 0) {
                const totalQuantity = cartItemsForMeal.reduce((sum, item) => sum + item.quantity, 0);
                cartBtn.classList.add('added');
                if (meal.sizes && meal.sizes.length > 0) {
                    cartBtn.textContent = `üõí Im Warenkorb (${totalQuantity}x) - Gr√∂√üe w√§hlen`;
                } else {
                    cartBtn.textContent = `üõí Im Warenkorb (${totalQuantity}x)`;
                }
            } else {
                cartBtn.classList.remove('added');
            }
            
            mealPopup.style.display = 'flex';
        }

        function renderCart() {
            cartItems.innerHTML = '';
            if (cart.length === 0) {
                cartItems.innerHTML = '<p>Ihr Warenkorb ist leer.</p>';
                return;
            }

            cart.forEach(item => {
                const meal = menuData.find(m => m.id === item.mealId);
                if (meal) {
                    const cartItemElement = document.createElement('div');
                    cartItemElement.className = 'cart-item';
                    
                    let price = meal.price || 0;
                    let sizeInfo = '';
                    
                    if (meal.sizes && meal.sizes.length > 0 && item.selectedSize) {
                        const size = meal.sizes.find(s => s.size === item.selectedSize);
                        if (size) {
                            price = size.price;
                            sizeInfo = `<div class="cart-item-size">Gr√∂√üe: ${item.selectedSize}${size.description ? ` (${size.description})` : ''}</div>`;
                        }
                    }
                    
                    const numberHTML = meal.number ? `<div class="cart-item-number">${meal.number}</div>` : '';
                    
                    cartItemElement.innerHTML = `
                        <div class="cart-item-info">
                            ${numberHTML}
                            <div>
                                <div class="cart-item-name">${meal.name}</div>
                                ${sizeInfo}
                                <div class="cart-item-price">‚Ç¨ ${price.toFixed(2)}</div>
                            </div>
                        </div>
                        <div class="cart-item-controls">
                            <button class="quantity-btn remove" data-meal-id="${meal.id}" data-size="${item.selectedSize || ''}">‚àí</button>
                            <span class="item-quantity">${item.quantity}</span>
                            <button class="quantity-btn" data-meal-id="${meal.id}" data-size="${item.selectedSize || ''}">+</button>
                        </div>
                    `;
                    cartItems.appendChild(cartItemElement);
                }
            });

            updateCartTotal();
        }

        // --- Warenkorb-Funktionen ---
        function showConfirmationPopup(mealId, size = null) {
            const meal = menuData.find(m => m.id === mealId);
            if (!meal) return;

            let sizeInfo = '';
            let price = meal.price || 0;
            
            if (meal.sizes && meal.sizes.length > 0 && size) {
                const selectedSizeObj = meal.sizes.find(s => s.size === size);
                if (selectedSizeObj) {
                    sizeInfo = ` (${size})`;
                    price = selectedSizeObj.price;
                }
            }

            confirmationTitle.textContent = `${meal.name}${sizeInfo} in den Warenkorb legen?`;
            confirmationText.textContent = `M√∂chten Sie "${meal.name}${sizeInfo}" f√ºr ‚Ç¨ ${price.toFixed(2)} in den Warenkorb legen?`;
            
            pendingAddToCart = { mealId, size };
            confirmationPopup.style.display = 'flex';
        }

        function addToCart(mealId, size = null) {
            const meal = menuData.find(m => m.id === mealId);
            if (!meal) return;

            if (meal.sizes && meal.sizes.length > 0 && !size) {
                alert('Bitte w√§hlen Sie eine Gr√∂√üe aus.');
                return;
            }

            const existingItemIndex = cart.findIndex(item => 
                item.mealId === mealId && item.selectedSize === size
            );

            if (existingItemIndex !== -1) {
                cart[existingItemIndex].quantity += 1;
            } else {
                cart.push({ 
                    mealId: mealId, 
                    quantity: 1,
                    selectedSize: size 
                });
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            
            if (currentMealId === mealId) {
                const cartBtn = document.getElementById('cartPopupBtn');
                const cartItemsForMeal = cart.filter(item => item.mealId === mealId);
                const totalQuantity = cartItemsForMeal.reduce((sum, item) => sum + item.quantity, 0);
                
                cartBtn.classList.add('added');
                if (meal.sizes && meal.sizes.length > 0) {
                    cartBtn.textContent = `üõí Im Warenkorb (${totalQuantity}x) - Gr√∂√üe w√§hlen`;
                } else {
                    cartBtn.textContent = `üõí Im Warenkorb (${totalQuantity}x)`;
                }
            }
            
            renderMenuItems();
            if (cartView.style.display === 'block') {
                renderCart();
            }
        }

        function removeFromCart(mealId, size = null) {
            const existingItemIndex = cart.findIndex(item => 
                item.mealId === mealId && item.selectedSize === size
            );

            if (existingItemIndex !== -1) {
                if (cart[existingItemIndex].quantity > 1) {
                    cart[existingItemIndex].quantity -= 1;
                } else {
                    cart.splice(existingItemIndex, 1);
                }
                localStorage.setItem('cart', JSON.stringify(cart));
                
                if (currentMealId === mealId) {
                    const cartBtn = document.getElementById('cartPopupBtn');
                    const meal = menuData.find(m => m.id === mealId);
                    const cartItemsForMeal = cart.filter(item => item.mealId === mealId);
                    
                    if (cartItemsForMeal.length > 0) {
                        const totalQuantity = cartItemsForMeal.reduce((sum, item) => sum + item.quantity, 0);
                        if (meal.sizes && meal.sizes.length > 0) {
                            cartBtn.textContent = `üõí Im Warenkorb (${totalQuantity}x) - Gr√∂√üe w√§hlen`;
                        } else {
                            cartBtn.textContent = `üõí Im Warenkorb (${totalQuantity}x)`;
                        }
                    } else {
                        cartBtn.textContent = meal.sizes && meal.sizes.length > 0 ? 
                            'üõí Bitte Gr√∂√üe w√§hlen' : 
                            `üõí In den Warenkorb - ‚Ç¨ ${(meal.price || 0).toFixed(2)}`;
                        cartBtn.classList.remove('added');
                        cartBtn.disabled = meal.sizes && meal.sizes.length > 0;
                    }
                }
                
                renderMenuItems();
                if (cartView.style.display === 'block') {
                    renderCart();
                }
            }
        }

        // --- Admin-Funktionen ---
        function toggleAdminMode(login = true) {
            if (login) {
                isAdminMode = true;
                adminArea.style.display = 'block';
            } else {
                isAdminMode = false;
                adminArea.style.display = 'none';
                resetForm();
            }
            renderMenuItems();
        }

        function fillFormForEdit(mealId) {
            const meal = menuData.find(m => m.id === mealId);
            if (!meal) return;

            document.getElementById('mealIdInput').value = meal.id;
            document.getElementById('mealNumber').value = meal.number || '';
            document.getElementById('mealName').value = meal.name;
            document.getElementById('mealCategory').value = meal.category;
            
            loadSizesIntoForm(meal.sizes);
            
            if (!meal.sizes || meal.sizes.length === 0) {
                document.getElementById('mealPrice').value = meal.price ? meal.price.toFixed(2) : '';
            } else {
                document.getElementById('mealPrice').value = '';
            }
            
            document.getElementById('mealDescription').value = meal.description || '';
            setCheckboxesFromTags(meal.tags);
            document.getElementById('mealIngredients').value = (meal.ingredients || []).join(',');
            
            currentBase64Image = meal.imageBase64 || null;
            updateImagePreview(currentBase64Image);

            saveMealBtn.textContent = '√Ñnderungen speichern';
        }
        
        function updateImagePreview(base64Data) {
            imagePreview.innerHTML = '';
            if (base64Data) {
                const img = document.createElement('img');
                img.src = base64Data;
                imagePreview.appendChild(img);
            } else {
                imagePreview.textContent = 'Bildvorschau';
            }
        }

        function resetForm() {
            menuItemForm.reset();
            document.getElementById('mealIdInput').value = '';
            saveMealBtn.textContent = 'Men√ºpunkt speichern';
            currentBase64Image = null;
            updateImagePreview(null);
            setCheckboxesFromTags([]);
            sizesContainer.innerHTML = '';
            singlePriceGroup.style.display = 'block';
        }
        
        function resizeImage(file, maxWidth = 400, maxHeight = 400, quality = 0.8) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        let width = img.width;
                        let height = img.height;

                        if (width > height) {
                            if (width > maxWidth) {
                                height *= maxWidth / width;
                                width = maxWidth;
                            }
                        } else {
                            if (height > maxHeight) {
                                width *= maxHeight / height;
                                height = maxHeight;
                            }
                        }

                        const canvas = document.createElement('canvas');
                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        resolve(canvas.toDataURL('image/jpeg', quality));
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }
        
        async function saveMenuItem(e) {
            e.preventDefault();

            const file = mealImageFile.files[0];
            let imageToSave = currentBase64Image;

            if (file) {
                try {
                    imageToSave = await resizeImage(file);
                } catch (error) {
                    alert("Fehler beim Verarbeiten des Bildes.");
                    console.error(error);
                    return;
                }
            } 

            const id = document.getElementById('mealIdInput').value;
            const numberInput = document.getElementById('mealNumber').value;
            const number = numberInput ? parseInt(numberInput) : null;
            const name = document.getElementById('mealName').value;
            const category = document.getElementById('mealCategory').value;
            
            const sizes = getSizesFromForm();
            const hasSizes = sizes.length > 0;
            
            let price = 0;
            if (!hasSizes) {
                price = parseFloat(document.getElementById('mealPrice').value);
                if (isNaN(price)) {
                    alert("Bitte geben Sie einen g√ºltigen Preis ein.");
                    return;
                }
            }
            
            const description = document.getElementById('mealDescription').value;
            const tags = getSelectedTags();
            const ingredients = document.getElementById('mealIngredients').value.split(',').map(item => item.trim()).filter(item => item);

            const newMeal = {
                name,
                category,
                description,
                tags,
                ingredients,
                imageBase64: imageToSave,
                number: number
            };

            if (hasSizes) {
                newMeal.sizes = sizes;
                delete newMeal.price;
            } else {
                newMeal.price = price;
                delete newMeal.sizes;
            }

            if (id) {
                const index = menuData.findIndex(m => m.id === parseInt(id));
                if (index !== -1) {
                    menuData[index] = { ...menuData[index], ...newMeal };
                    alert(`Gericht "${name}" erfolgreich aktualisiert!`);
                }
            } else {
                const newId = menuData.length > 0 ? Math.max(...menuData.map(m => m.id)) + 1 : 1;
                menuData.push({ id: newId, ...newMeal });
                alert(`Gericht "${name}" erfolgreich hinzugef√ºgt!`);
            }

            saveMenuData();
            resetForm();
            renderMenuItems();
        }

        function deleteMenuItem(mealId) {
            if (confirm("Sind Sie sicher, dass Sie dieses Gericht l√∂schen m√∂chten?")) {
                menuData = menuData.filter(m => m.id !== mealId);
                saveMenuData();
                renderMenuItems();
                alert("Gericht gel√∂scht.");
            }
        }

        function saveRestaurantInfoForm(e) {
            e.preventDefault();

            const newInfo = {
                name: document.getElementById('restaurantNameInput').value || defaultRestaurantInfo.name,
                phone: document.getElementById('restaurantPhoneInput').value || defaultRestaurantInfo.phone,
                address: document.getElementById('restaurantAddressInput').value || defaultRestaurantInfo.address,
                zip: document.getElementById('restaurantZipInput').value || defaultRestaurantInfo.zip,
                city: document.getElementById('restaurantCityInput').value || defaultRestaurantInfo.city,
                hours: document.getElementById('restaurantHoursInput').value || defaultRestaurantInfo.hours
            };

            restaurantInfo = newInfo;
            saveRestaurantInfo(restaurantInfo);
            updateRestaurantDisplay();
            alert("Restaurant Informationen erfolgreich gespeichert!");
        }

        // --- Event Listeners ---
        function setupEventListeners() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    renderMenuItems();
                });
            });

            document.querySelectorAll('input[name="tags"]').forEach(checkbox => {
                checkbox.addEventListener('change', updateSelectedTagsDisplay);
            });

            adminLogoutBtn.addEventListener('click', () => toggleAdminMode(false));

            mealImageFile.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (file) {
                    try {
                        const base64Preview = await new Promise(resolve => {
                            const reader = new FileReader();
                            reader.onload = () => resolve(reader.result);
                            reader.readAsDataURL(file);
                        });
                        currentBase64Image = base64Preview;
                        updateImagePreview(base64Preview);
                    } catch (err) {
                        console.error("Fehler beim Lesen der Datei:", err);
                        alert("Fehler beim Lesen der Datei.");
                    }
                } else {
                    if (document.getElementById('mealIdInput').value === '') {
                         currentBase64Image = null; 
                    }
                    updateImagePreview(currentBase64Image);
                }
            });

            menuGrid.addEventListener('click', (e) => {
                const target = e.target;
                const menuItem = target.closest('.menu-item');
                
                if (!menuItem) return;

                const mealId = parseInt(menuItem.dataset.id);

                if (isAdminMode) {
                    if (target.classList.contains('admin-edit-btn')) {
                        fillFormForEdit(mealId);
                        adminArea.scrollIntoView({ behavior: 'smooth' });
                        return;
                    } 
                    if (target.classList.contains('admin-delete-btn')) {
                        deleteMenuItem(mealId);
                        return;
                    }
                    fillFormForEdit(mealId);
                    adminArea.scrollIntoView({ behavior: 'smooth' });
                    return;
                }

                openMealPopup(mealId);
            });
            
            cartItems.addEventListener('click', (e) => {
                if (e.target.classList.contains('quantity-btn')) {
                    const mealId = parseInt(e.target.dataset.mealId);
                    const size = e.target.dataset.size || null;
                    if (e.target.classList.contains('remove')) {
                        removeFromCart(mealId, size);
                    } else {
                        addToCart(mealId, size);
                    }
                }
            });

            menuItemForm.addEventListener('submit', saveMenuItem);
            document.getElementById('resetFormBtn').addEventListener('click', resetForm);

            restaurantInfoForm.addEventListener('submit', saveRestaurantInfoForm);

            categoryAdminForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const raw = newCategoryInput.value.trim();
                if (!raw) return;
                const id = slugify(raw);
                if (id === '' || categories.includes(id)) {
                    alert('Kategorie existiert bereits oder ung√ºltig.');
                    return;
                }
                categories.push(id);
                saveCategories(categories);
                newCategoryInput.value = '';
                renderCategoriesUI();
            });

            document.addEventListener('keydown', (e) => {
                if (!isAdminMode && (e.ctrlKey && e.altKey && e.key === 'a' || e.metaKey && e.altKey && e.key === 'a')) {
                    e.preventDefault();
                    toggleAdminMode(true);
                }
            });
            
            document.getElementById('closePopup').addEventListener('click', () => {
                mealPopup.style.display = 'none';
            });
            
            document.getElementById('cartPopupBtn').addEventListener('click', () => {
                showConfirmationPopup(currentMealId, selectedSize);
            });
            
            mealPopup.addEventListener('click', (e) => {
                if (e.target === mealPopup) {
                    mealPopup.style.display = 'none';
                }
            });

            confirmYes.addEventListener('click', () => {
                if (pendingAddToCart) {
                    addToCart(pendingAddToCart.mealId, pendingAddToCart.size);
                    pendingAddToCart = null;
                }
                confirmationPopup.style.display = 'none';
            });

            confirmNo.addEventListener('click', () => {
                pendingAddToCart = null;
                confirmationPopup.style.display = 'none';
            });

            confirmationPopup.addEventListener('click', (e) => {
                if (e.target === confirmationPopup) {
                    pendingAddToCart = null;
                    confirmationPopup.style.display = 'none';
                }
            });

            document.getElementById('showCart').addEventListener('click', () => {
                menuView.style.display = 'none';
                cartView.style.display = 'block';
                renderCart();
            });

            document.getElementById('backToMenu').addEventListener('click', () => {
                cartView.style.display = 'none';
                menuView.style.display = 'block';
            });
        }

        // --- Initialisierung ---
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM geladen, starte Initialisierung...');
            initializeMenu();
        });
    </script>
</body>
</html>


<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bella Vista - Speisekarte</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%232c5530' d='M8.1 13.34l2.83-2.83L3.91 3.5c-1.56 1.56-1.56 4.09 0 5.66l4.19 4.18zm6.78-1.81c1.53.71 3.68.21 5.27-1.38 1.91-1.91 2.28-4.65.81-6.12-1.46-1.46-4.2-1.1-6.12.81-1.59 1.59-2.09 3.74-1.38 5.27L3.7 19.87l1.41 1.41L12 14.41l6.88 6.88 1.41-1.41L13.41 13l1.47-1.47z'/></svg>" type="image/svg+xml">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f8f8;
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: calc(100vh - 200px);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            border: 2px solid #2c5530;
        }

        h1 {
            color: #2c5530;
            margin-bottom: 10px;
        }

        .header-phone {
            margin-top: 10px;
            font-size: 1.1em;
            color: #2c5530;
            font-weight: bold;
        }

        .delivery-banner {
            margin-top: 8px;
            font-size: 0.9em;
            color: #27ae60;
            font-weight: bold;
            background: #e8f5e8;
            padding: 5px 15px;
            border-radius: 15px;
            display: inline-block;
            border: 1px solid #27ae60;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: white;
            border: 2px solid #2c5530;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }

        .control-item select, .control-item input {
            border: none;
            background: none;
            outline: none;
            width: 100%;
            font-size: 14px;
            cursor: pointer;
        }

        .control-item:hover {
            background: #f0f7f0;
        }

        .cart-control {
            background: white;
            border: 2px solid #2c5530;
            border-radius: 8px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            min-width: 140px;
            justify-content: center;
        }

        .cart-control:hover {
            background: #2c5530;
            color: white;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .menu-item h3 {
            color: #2c5530;
            margin-bottom: 10px;
        }

        .menu-item-number {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #2c5530;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }

        .price {
            font-weight: bold;
            color: #e74c3c;
            font-size: 1.2em;
            margin: 10px 0;
        }

        .description {
            color: #666;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .menu-item .ingredients-label {
            font-weight: bold;
            color: #2c5530;
            margin: 8px 0 5px 0;
            font-size: 0.9em;
        }

        .menu-item .ingredients {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .tag {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            background: #f0f0f0;
            transition: all 0.3s;
        }

        .tag.vegetarisch { background: #d1ecf1; color: #0c5460; }
        .tag.scharf { background: #f8d7da; color: #721c24; }
        .tag.ohne Schweinefleisch { background: #d4edda; color: #155724; }
        .tag.vegan { background: #e8f6f3; color: #0b5345; }
        .tag.laktosefrei { background: #fef9e7; color: #7d6608; }

        .tag:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .cart-indicator {
            background: #d4edda;
            color: #155724;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
        }

        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .popup-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            background: none;
            border: none;
            color: #666;
        }

        .popup-image {
            width: 100%;
            height: 200px;
            background: #eee;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            overflow: hidden;
            position: relative;
        }
        
        .popup-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-type-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: bold;
        }

        .size-selection {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .size-selection h4 {
            margin-bottom: 15px;
            color: #2c5530;
            text-align: center;
        }

        .size-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .size-option {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .size-option:hover {
            border-color: #2c5530;
        }

        .size-option.selected {
            border-color: #2c5530;
            background: #f0f7f0;
        }

        .size-option input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .size-label {
            flex: 1;
            font-weight: bold;
        }

        .size-price {
            font-weight: bold;
            color: #e74c3c;
            font-size: 1.1em;
        }

        .size-description {
            font-size: 0.9em;
            color: #666;
            margin-left: 25px;
            margin-top: 2px;
        }

        .cart-popup-btn {
            width: 100%;
            padding: 12px;
            background: #2c5530;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: bold;
            transition: background 0.3s;
        }

        .cart-popup-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .cart-popup-btn:hover:not(:disabled) {
            background: #1e3a23;
        }

        .cart-popup-btn.added {
            background: #27ae60;
        }

        .allergens-section {
            margin: 20px 0 0 0;
            padding: 15px 0 0 0;
            border-top: 2px solid #e9ecef;
        }

        .allergens-section h4 {
            color: #2c5530;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .allergen-item {
            padding: 3px 0;
            color: #666;
            font-size: 0.85em;
        }

        .additives-section {
            margin: 15px 0 0 0;
            padding: 15px 0 0 0;
            border-top: 1px solid #e9ecef;
        }

        .additives-section h4 {
            color: #2c5530;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .additive-item {
            padding: 3px 0;
            color: #666;
            font-size: 0.85em;
        }

        .cart-view {
            display: none;
        }

        .back-btn {
            padding: 10px 20px;
            background: #666;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .cart-summary {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .cart-total {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c5530;
            text-align: right;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #eee;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            gap: 15px;
        }

        .cart-item-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .cart-item-size {
            font-size: 0.9em;
            color: #666;
        }

        .cart-item-price {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.1em;
            min-width: 80px;
            text-align: right;
            margin-right: 15px;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 120px;
            justify-content: flex-end;
        }

        .quantity-btn {
            padding: 8px 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            min-width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-btn.remove {
            background: #e74c3c;
        }

        .item-quantity {
            font-weight: bold;
            min-width: 30px;
            text-align: center;
            font-size: 1.1em;
        }

        .cart-item-number {
            background: #2c5530;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8em;
            flex-shrink: 0;
        }

        .phone-btn {
            width: 100%;
            padding: 15px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s;
            text-decoration: none;
            display: block;
            text-align: center;
        }

        .phone-btn:hover {
            background: #219a52;
        }

        .phone-info {
            text-align: center;
            margin-top: 10px;
            color: #666;
            font-size: 0.9em;
        }

        footer {
            background: #2c5530;
            color: white;
            padding: 20px 0;
            margin-top: 40px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .footer-section h3 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .footer-section p {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .footer-bottom {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .scroll-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: #2c5530;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s;
            z-index: 1000;
        }

        .scroll-to-top:hover {
            background: #1e3a23;
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        @media (max-width: 768px) {
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .control-item, .cart-control {
                width: 100%;
            }

            .cart-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .cart-item-controls {
                width: 100%;
                justify-content: space-between;
            }

            .cart-item-price {
                text-align: left;
                margin-right: 0;
            }

            .footer-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .size-options {
                gap: 8px;
            }

            .size-option {
                padding: 10px 12px;
            }

            .scroll-to-top {
                bottom: 20px;
                right: 20px;
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
        }

        .no-items {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1em;
        }

        .confirmation-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .confirmation-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .confirmation-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .confirm-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .confirm-ok {
            background: #27ae60;
            color: white;
        }

        .confirm-ok:hover {
            background: #219a52;
        }

        .confirm-no {
            background: #e74c3c;
            color: white;
        }

        .confirm-no:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <button class="scroll-to-top" id="scrollToTopBtn" title="Nach oben scrollen">‚Üë</button>

    <div class="container">
        <header>
            <h1 id="restaurantName">üçù Bella Vista</h1>
            <p>Willkommen zu unserer digitalen Speisekarte</p>
            <div class="header-phone" id="headerPhone">üìû 02327 303687</div>
            <div class="delivery-banner">üöó Lieferung m√∂glich</div>
        </header>

        <div class="controls" id="mainControls">
            <div class="control-item">
                <span>üìã</span>
                <select id="categoryFilter">
                    <option value="all">Alle Kategorien</option>
                    <option value="pizza">Pizza</option>
                    <option value="nudeln">Nudeln</option>
                    <option value="salate">Salate</option>
                    <option value="gyros">Gyros</option>
                </select>
            </div>
            <div class="control-item">
                <span>‚≠ê</span>
                <select id="specialWishesFilter">
                    <option value="all">Alle Sonderw√ºnsche</option>
                    <option value="vegetarisch">Vegetarisch</option>
                    <option value="scharf">Scharf</option>
                    <option value="ohne Schweinefleisch">Ohne Schweinefleisch</option>
                </select>
            </div>
            <div class="control-item">
                <span>üîç</span>
                <input type="text" id="searchInput" placeholder="Gerichte suchen...">
            </div>
            <div class="cart-control" id="showCart">
                <span>üõí</span>
                <span>Warenkorb (<span id="cartCount">0</span>)</span>
            </div>
        </div>

        <div class="menu-view" id="menuView">
            <div class="menu-grid" id="menuGrid">
                <!-- Men√ºpunkte werden hier dynamisch eingef√ºgt -->
            </div>
        </div>

        <div class="cart-view" id="cartView">
            <button class="back-btn" id="backToMenu">‚Üê Zur√ºck zur Karte</button>
            <h2>Ihr Warenkorb</h2>
            
            <div class="cart-summary">
                <div id="cartItems">
                    <!-- Warenkorb Items werden hier eingef√ºgt -->
                </div>
                <div class="cart-total" id="cartTotal">
                    Gesamt: ‚Ç¨ 0,00
                </div>
            </div>
            
            <a href="tel:02327303687" class="phone-btn" id="cartPhoneBtn">üìû Jetzt anrufen & bestellen: 02327 303687</a>
            <div class="phone-info">Beim Klick auf den Button werden Sie verbunden</div>
        </div>
    </div>

    <footer id="restaurantFooter">
        <div class="footer-content">
            <div class="footer-section">
                <h3 id="footerRestaurantName">Bella Vista</h3>
                <p id="footerAddress">Weststra√üe 181</p>
                <p id="footerZipCity">44866 Bochum Wattenscheid</p>
            </div>
            <div class="footer-section">
                <h3>√ñffnungszeiten</h3>
                <div id="footerHours">
                    <p>Mo: 11:30 - 14:30 Uhr & 17:00 - 22:30 Uhr</p>
                    <p>Di - Fr: 11:30 - 22:30 Uhr</p>
                    <p>Sa, So, Feiertage: 15:00 - 22:30 Uhr</p>
                </div>
            </div>
            <div class="footer-section">
                <h3>Kontakt</h3>
                <p id="footerPhone">üìû 02327 303687</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Bella Vista. Alle Rechte vorbehalten.</p>
        </div>
    </footer>

    <!-- Popup f√ºr Gerichte-Details -->
    <div class="popup" id="mealPopup">
        <div class="popup-content">
            <button class="close-btn" id="closePopup">&times;</button>
            <div class="popup-image" id="popupImage">
                <!-- Bild wird hier eingef√ºgt -->
            </div>
            <h2 id="popupTitle">Gericht Name</h2>
            
            <div class="size-selection" id="sizeSelection" style="display: none;">
                <h4>Bitte w√§hlen Sie eine Gr√∂√üe:</h4>
                <div class="size-options" id="sizeOptions">
                    <!-- Gr√∂√üen werden hier dynamisch eingef√ºgt -->
                </div>
            </div>

            <div class="price" id="popupPrice">‚Ç¨ 0,00</div>
            <p class="description" id="popupDescription" style="display: none;">Beschreibung des Gerichts...</p>
            
            <div class="ingredients-label">Zutaten:</div>
            <p class="ingredients" id="popupIngredients"></p>
            
            <div class="tags" id="popupTags"></div>
            
            <button class="cart-popup-btn" id="cartPopupBtn" disabled>üõí Bitte Gr√∂√üe w√§hlen</button>
            
            <div class="allergens-section" id="allergensSection" style="display: none;">
                <h4>Allergene</h4>
                <div class="allergens-content" id="allergensContent">
                    <!-- Allergene werden hier dynamisch eingef√ºgt -->
                </div>
            </div>

            <div class="additives-section" id="additivesSection" style="display: none;">
                <h4>Zusatzstoffe</h4>
                <div class="additives-content" id="additivesContent">
                    <!-- Zusatzstoffe werden hier dynamisch eingef√ºgt -->
                </div>
            </div>
        </div>
    </div>

    <!-- Best√§tigungs-Popup -->
    <div class="confirmation-popup" id="confirmationPopup">
        <div class="confirmation-content">
            <h3 id="confirmationTitle">In den Warenkorb legen?</h3>
            <p id="confirmationText">M√∂chten Sie dieses Gericht in den Warenkorb legen?</p>
            <div class="confirmation-buttons">
                <button class="confirm-btn confirm-ok" id="confirmOk">OK</button>
                <button class="confirm-btn confirm-no" id="confirmNo">Abbrechen</button>
            </div>
        </div>
    </div>

    <script>
        // ===== KONFIGURATION =====
        
        // Restaurant Informationen
        const restaurantInfo = {
            name: "Bella Vista",
            phone: "02327 303687",
            address: "Weststra√üe 181",
            zip: "44866", 
            city: "Bochum Wattenscheid",
            hours: "Mo: 11:30 - 14:30 Uhr & 17:00 - 22:30 Uhr\nDi - Fr: 11:30 - 22:30 Uhr\nSa, So, Feiertage: 15:00 - 22:30 Uhr",
            deliveryAvailable: true
        };

        // Men√º Daten - AKTUALISIERT mit korrekten Daten aus der PDF
        const menuData = [
            {
                id: 1,
                number: 1,
                name: "Pizza Margherita",
                category: "pizza",
                sizes: [
                    { size: "Klein (25 cm)", price: 5.00, description: "25 cm" },
                    { size: "Gro√ü (28 cm)", price: 6.00, description: "28 cm" }
                ],
                ingredients: ["Tomatensauce", "K√§se", "Oregano"],
                tags: ["vegetarisch", "ohne Schweinefleisch"],
                allergens: ["A", "F", "G", "J", "M"],
                additives: ["2"]
            },
            {
                id: 2,
                number: 2,
                name: "Pizza Salami",
                category: "pizza",
                sizes: [
                    { size: "Klein (25 cm)", price: 5.00, description: "25 cm" },
                    { size: "Gro√ü (28 cm)", price: 6.00, description: "28 cm" }
                ],
                ingredients: ["Tomatensauce", "K√§se", "Oregano", "Salami"],
                tags: [],
                allergens: ["A", "F", "G", "J", "M"],
                additives: ["1", "2", "3", "12"]
            },
            {
                id: 3,
                number: 79,
                name: "Nudeln Alla Tonno",
                category: "nudeln",
                price: 7.00,
                ingredients: ["Thunfisch", "Knoblauch", "Peperoni", "Tomaten-Sahnesauce"],
                tags: ["scharf", "ohne Schweinefleisch"],
                allergens: ["A", "C", "D", "L", "N", "G"],
                additives: ["12"]
            },
            {
                id: 4,
                number: 80,
                name: "Nudeln Napoli",
                category: "nudeln",
                price: 7.00,
                ingredients: ["Tomatensauce", "frischer Basilikum"],
                tags: ["vegetarisch", "ohne Schweinefleisch"],
                allergens: ["A", "C", "I", "J"],
                additives: ["7"]
            },
            {
                id: 5,
                number: 60,
                name: "Salat Mista",
                category: "salate",
                sizes: [
                    { size: "Standard", price: 4.00 },
                    { size: "Gro√ü", price: 6.00 }
                ],
                ingredients: ["Bunter Salat mit Gurken"],
                tags: ["vegetarisch", "ohne Schweinefleisch"],
                allergens: [],
                additives: []
            },
            {
                id: 6,
                number: 61,
                name: "Salat Caprese",
                category: "salate",
                sizes: [
                    { size: "Standard", price: 5.00 },
                    { size: "Gro√ü", price: 7.00 }
                ],
                ingredients: ["Frische Tomaten", "Mozzarella", "Basilikum"],
                tags: ["vegetarisch", "ohne Schweinefleisch"],
                allergens: [],
                additives: []
            },
            {
                id: 7,
                number: 169,
                name: "Gyros Pita",
                category: "gyros",
                price: 7.00,
                ingredients: ["Gyros", "Krautsalat", "Zwiebeln", "Tzatziki"],
                tags: [],
                allergens: ["E", "F", "G", "H", "L", "M"],
                additives: ["2"]
            },
            {
                id: 8,
                number: 172,
                name: "Gyros Metaxa",
                category: "gyros",
                price: 10.00,
                ingredients: ["√úberbacken mit Metaxasauce", "Spinat"],
                tags: [],
                allergens: ["L", "M", "G"],
                additives: ["1"]
            }
        ];

        // Allergen-Legende - AKTUALISIERT
        const allergenLegend = {
            'A': 'Glutenhaltiges Getreide',
            'B': 'Krebstiere', 
            'C': 'Eier',
            'D': 'Fische',
            'E': 'Erdn√ºsse',
            'F': 'Sojabohnen',
            'G': 'Milch',
            'H': 'Schalenfr√ºchte',
            'I': 'Sellerie',
            'J': 'Senf',
            'K': 'Sesamsamen',
            'L': 'Schwefeldioxid und Sulfite',
            'M': 'Lupinen',
            'N': 'Weichtiere'
        };

        // Zusatzstoff-Legende - AKTUALISIERT
        const additiveLegend = {
            '1': 'Farbstoff',
            '2': 'Konservierungsstoff',
            '3': 'Antioxidationsmittel',
            '4': 'Geschw√§rzt',
            '7': 'Phosphat',
            '8': 'Geschmacksverst√§rker',
            '9': 'Formfleischvorderschinken',
            '10': 'S√º√üungsmittel',
            '11': 'S√§uerungsmittel',
            '12': 'Nitritp√∂kelsalz & Nitrat',
            '13': 'Koffeinhaltig',
            '14': 'Phenylananinquelle',
            '16': 'Rindfleisch'
        };

        // ===== VARIABLEN =====
        let currentCategory = 'all';
        let currentSpecialWish = 'all';
        let currentSearch = '';
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let currentMealId = null;
        let selectedSize = null;
        let pendingAddToCart = null;

        // ===== DOM ELEMENTE =====
        const menuGrid = document.getElementById('menuGrid');
        const cartItems = document.getElementById('cartItems');
        const mealPopup = document.getElementById('mealPopup');
        const cartView = document.getElementById('cartView');
        const menuView = document.getElementById('menuView');
        const cartTotal = document.getElementById('cartTotal');
        const mainControls = document.getElementById('mainControls');

        // ===== HILFSFUNKTIONEN =====
        function displayLabelForCategory(catId) {
            const labels = {
                'all': 'Alle Kategorien',
                'pizza': 'Pizza',
                'nudeln': 'Nudeln', 
                'salate': 'Salate',
                'gyros': 'Gyros'
            };
            return labels[catId] || catId;
        }

        function getDisplayPrice(meal) {
            if (meal.sizes && meal.sizes.length > 0) {
                const prices = meal.sizes.map(size => size.price);
                const minPrice = Math.min(...prices);
                const maxPrice = Math.max(...prices);
                if (minPrice === maxPrice) {
                    return `‚Ç¨ ${minPrice.toFixed(2)}`;
                }
                return `‚Ç¨ ${minPrice.toFixed(2)} - ${maxPrice.toFixed(2)}`;
            }
            return meal.price ? `‚Ç¨ ${meal.price.toFixed(2)}` : '‚Ç¨ 0,00';
        }

        function updateCartTotal() {
            const total = cart.reduce((sum, item) => {
                const meal = menuData.find(m => m.id === item.mealId);
                if (!meal) return sum;
                
                if (meal.sizes && meal.sizes.length > 0) {
                    const size = meal.sizes.find(s => s.size === item.selectedSize);
                    return sum + (size ? size.price * item.quantity : 0);
                }
                return sum + ((meal.price || 0) * item.quantity);
            }, 0);
            cartTotal.textContent = `Gesamt: ‚Ç¨ ${total.toFixed(2)}`;
        }

        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = totalItems;
        }

        function getAllergenText(allergenCodes) {
            return allergenCodes.map(code => allergenLegend[code]).filter(text => text);
        }

        function getAdditiveText(additiveCodes) {
            return additiveCodes.map(code => additiveLegend[code] || code).filter(text => text);
        }

        function toggleScrollToTopButton() {
            const scrollToTopBtn = document.getElementById('scrollToTopBtn');
            if (window.pageYOffset > 300) {
                scrollToTopBtn.style.display = 'flex';
            } else {
                scrollToTopBtn.style.display = 'none';
            }
        }

        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // ===== RENDERING FUNKTIONEN =====
        function renderMenuItems() {
            menuGrid.innerHTML = '';
            
            if (menuData.length === 0) {
                menuGrid.innerHTML = '<div class="no-items">Noch keine Gerichte vorhanden.</div>';
                return;
            }
            
            const filteredMeals = menuData.filter(meal => {
                const categoryMatch = currentCategory === 'all' || meal.category === currentCategory;
                const specialWishMatch = currentSpecialWish === 'all' || (meal.tags && meal.tags.includes(currentSpecialWish));
                const searchMatch = currentSearch === '' || 
                    meal.name.toLowerCase().includes(currentSearch.toLowerCase()) ||
                    (meal.ingredients && meal.ingredients.some(ingredient => 
                        ingredient.toLowerCase().includes(currentSearch.toLowerCase())
                    ));
                
                return categoryMatch && specialWishMatch && searchMatch;
            });

            filteredMeals.forEach(meal => {
                const item = document.createElement('div');
                item.className = 'menu-item';
                item.onclick = () => openMealPopup(meal.id);
                
                const cartItem = cart.find(item => item.mealId === meal.id);
                const cartIndicator = cartItem ? `<div class="cart-indicator">${cartItem.quantity}x</div>` : '';
                
                item.innerHTML = `
                    <div class="menu-item-number">${meal.number}</div>
                    <h3>${meal.name}</h3>
                    <div class="price">${getDisplayPrice(meal)}</div>
                    <div class="ingredients-label">Zutaten:</div>
                    <p class="ingredients">${meal.ingredients.join(', ')}</p>
                    <div class="tags">
                        ${meal.tags.map(tag => `<span class="tag ${tag}">${tag}</span>`).join('')}
                        ${cartIndicator}
                    </div>
                `;
                
                menuGrid.appendChild(item);
            });
        }

        function renderCartItems() {
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<div class="no-items">Ihr Warenkorb ist leer</div>';
                return;
            }
            
            cart.forEach((item, index) => {
                const meal = menuData.find(m => m.id === item.mealId);
                if (!meal) return;
                
                const itemPrice = meal.sizes && meal.sizes.length > 0 ? 
                    meal.sizes.find(s => s.size === item.selectedSize)?.price || 0 : 
                    meal.price || 0;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-number">${meal.number}</div>
                        <div>
                            <div class="cart-item-name">${meal.name}</div>
                            ${item.selectedSize ? `<div class="cart-item-size">${item.selectedSize}</div>` : ''}
                        </div>
                    </div>
                    <div class="cart-item-price">‚Ç¨ ${(itemPrice * item.quantity).toFixed(2)}</div>
                    <div class="cart-item-controls">
                        <button class="quantity-btn remove" onclick="removeFromCart(${index})">-</button>
                        <span class="item-quantity">${item.quantity}</span>
                        <button class="quantity-btn" onclick="addToCartFromCart(${index})">+</button>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });
            
            updateCartTotal();
        }

        function openMealPopup(mealId) {
            const meal = menuData.find(m => m.id === mealId);
            if (!meal) return;
            
            currentMealId = mealId;
            selectedSize = null;
            
            document.getElementById('popupTitle').textContent = meal.name;
            document.getElementById('popupPrice').textContent = getDisplayPrice(meal);
            document.getElementById('popupIngredients').textContent = meal.ingredients.join(', ');
            
            const popupTags = document.getElementById('popupTags');
            popupTags.innerHTML = meal.tags.map(tag => `<span class="tag ${tag}">${tag}</span>`).join('');
            
            const sizeSelection = document.getElementById('sizeSelection');
            const sizeOptions = document.getElementById('sizeOptions');
            
            if (meal.sizes && meal.sizes.length > 0) {
                sizeSelection.style.display = 'block';
                sizeOptions.innerHTML = '';
                
                meal.sizes.forEach((sizeOption, index) => {
                    const sizeDiv = document.createElement('div');
                    sizeDiv.className = 'size-option';
                    if (index === 0) {
                        sizeDiv.classList.add('selected');
                        selectedSize = sizeOption.size;
                    }
                    
                    sizeDiv.innerHTML = `
                        <input type="radio" name="size" value="${sizeOption.size}" ${index === 0 ? 'checked' : ''}>
                        <span class="size-label">${sizeOption.size}</span>
                        <span class="size-price">‚Ç¨ ${sizeOption.price.toFixed(2)}</span>
                        ${sizeOption.description ? `<div class="size-description">${sizeOption.description}</div>` : ''}
                    `;
                    
                    sizeDiv.onclick = () => {
                        document.querySelectorAll('.size-option').forEach(opt => opt.classList.remove('selected'));
                        sizeDiv.classList.add('selected');
                        sizeDiv.querySelector('input').checked = true;
                        selectedSize = sizeOption.size;
                        updateCartButtonState();
                    };
                    
                    sizeOptions.appendChild(sizeDiv);
                });
            } else {
                sizeSelection.style.display = 'none';
                selectedSize = null;
            }
            
            const allergensSection = document.getElementById('allergensSection');
            const allergensContent = document.getElementById('allergensContent');
            if (meal.allergens && meal.allergens.length > 0) {
                allergensSection.style.display = 'block';
                allergensContent.innerHTML = getAllergenText(meal.allergens)
                    .map(text => `<div class="allergen-item">${text}</div>`)
                    .join('');
            } else {
                allergensSection.style.display = 'none';
            }
            
            const additivesSection = document.getElementById('additivesSection');
            const additivesContent = document.getElementById('additivesContent');
            if (meal.additives && meal.additives.length > 0) {
                additivesSection.style.display = 'block';
                additivesContent.innerHTML = getAdditiveText(meal.additives)
                    .map(text => `<div class="additive-item">${text}</div>`)
                    .join('');
            } else {
                additivesSection.style.display = 'none';
            }
            
            updateCartButtonState();
            mealPopup.style.display = 'flex';
        }

        function updateCartButtonState() {
            const btn = document.getElementById('cartPopupBtn');
            if (selectedSize !== null || !menuData.find(m => m.id === currentMealId)?.sizes) {
                btn.disabled = false;
                btn.textContent = 'üõí In den Warenkorb';
            } else {
                btn.disabled = true;
                btn.textContent = 'üõí Bitte Gr√∂√üe w√§hlen';
            }
        }

        // ===== CART FUNKTIONEN =====
        function addToCart() {
            if (!currentMealId) return;
            
            const meal = menuData.find(m => m.id === currentMealId);
            if (!meal) return;
            
            const existingItemIndex = cart.findIndex(item => 
                item.mealId === currentMealId && 
                item.selectedSize === selectedSize
            );
            
            if (existingItemIndex !== -1) {
                cart[existingItemIndex].quantity += 1;
            } else {
                cart.push({
                    mealId: currentMealId,
                    selectedSize: selectedSize,
                    quantity: 1
                });
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            closePopup();
            
            showConfirmation('Erfolg', `${meal.name} wurde zum Warenkorb hinzugef√ºgt!`);
        }

        function addToCartFromCart(index) {
            cart[index].quantity += 1;
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            renderCartItems();
        }

        function removeFromCart(index) {
            if (cart[index].quantity > 1) {
                cart[index].quantity -= 1;
            } else {
                cart.splice(index, 1);
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            renderCartItems();
        }

        function clearCart() {
            cart = [];
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            renderCartItems();
        }

        // ===== VIEW FUNKTIONEN =====
        function showCartView() {
            menuView.style.display = 'none';
            cartView.style.display = 'block';
            mainControls.style.display = 'none';
            renderCartItems();
        }

        function showMenuView() {
            cartView.style.display = 'none';
            menuView.style.display = 'block';
            mainControls.style.display = 'flex';
        }

        function closePopup() {
            mealPopup.style.display = 'none';
            currentMealId = null;
            selectedSize = null;
        }

        function showConfirmation(title, text) {
            const popup = document.getElementById('confirmationPopup');
            document.getElementById('confirmationTitle').textContent = title;
            document.getElementById('confirmationText').textContent = text;
            popup.style.display = 'flex';
            
            document.getElementById('confirmOk').onclick = () => {
                popup.style.display = 'none';
            };
            
            document.getElementById('confirmNo').onclick = () => {
                popup.style.display = 'none';
            };
        }

        // ===== EVENT LISTENER =====
        document.getElementById('categoryFilter').addEventListener('change', (e) => {
            currentCategory = e.target.value;
            renderMenuItems();
        });

        document.getElementById('specialWishesFilter').addEventListener('change', (e) => {
            currentSpecialWish = e.target.value;
            renderMenuItems();
        });

        document.getElementById('searchInput').addEventListener('input', (e) => {
            currentSearch = e.target.value;
            renderMenuItems();
        });

        document.getElementById('showCart').addEventListener('click', showCartView);
        document.getElementById('backToMenu').addEventListener('click', showMenuView);
        document.getElementById('closePopup').addEventListener('click', closePopup);
        document.getElementById('cartPopupBtn').addEventListener('click', addToCart);
        document.getElementById('scrollToTopBtn').addEventListener('click', scrollToTop);

        // Schlie√üe Popup wenn au√üerhalb geklickt wird
        mealPopup.addEventListener('click', (e) => {
            if (e.target === mealPopup) {
                closePopup();
            }
        });

        // ===== INITIALISIERUNG =====
        function init() {
            // Restaurant Informationen setzen
            document.getElementById('restaurantName').textContent = restaurantInfo.name;
            document.getElementById('headerPhone').textContent = `üìû ${restaurantInfo.phone}`;
            document.getElementById('footerRestaurantName').textContent = restaurantInfo.name;
            document.getElementById('footerAddress').textContent = restaurantInfo.address;
            document.getElementById('footerZipCity').textContent = `${restaurantInfo.zip} ${restaurantInfo.city}`;
            document.getElementById('footerPhone').textContent = `üìû ${restaurantInfo.phone}`;
            
            // Men√º initialisieren
            renderMenuItems();
            updateCartCount();
            
            // Scroll Event Listener
            window.addEventListener('scroll', toggleScrollToTopButton);
            
            // Initial scroll button state
            toggleScrollToTopButton();
        }

        // Starte die Anwendung
        init();
    </script>
</body>
</html>
